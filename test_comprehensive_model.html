<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Data Model Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
        }
        .pass { background: #4CAF50; color: white; }
        .fail { background: #f44336; color: white; }
        .pending { background: #FF9800; color: white; }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
        }
        .field-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .field-item {
            padding: 8px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 12px;
        }
        .field-item.has-value {
            background: #c8e6c9;
        }
        .field-item.empty {
            background: #ffccbc;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <h1>üß™ SignalsAI Comprehensive Data Model Validation</h1>
    
    <div class="test-section">
        <h2>1. Data Loading Test</h2>
        <div id="dataLoadTest"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Field Coverage Test (100+ Fields)</h2>
        <div id="fieldCoverageTest"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Signal Polarity Test</h2>
        <div id="polarityTest"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Plays System Test</h2>
        <div id="playsTest"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Account Metrics Test</h2>
        <div id="metricsTest"></div>
    </div>
    
    <div class="test-section">
        <h2>6. CRUD Operations Test</h2>
        <button onclick="testCRUD()">Run CRUD Tests</button>
        <div id="crudTest"></div>
    </div>
    
    <div class="test-section">
        <h2>7. View Rendering Test</h2>
        <button onclick="testViews()">Test All Views</button>
        <div id="viewTest"></div>
    </div>
    
    <div class="test-section">
        <h2>8. Performance Test</h2>
        <div id="performanceTest"></div>
    </div>

    <script>
        // Test comprehensive data model
        async function runTests() {
            console.log('üöÄ Starting comprehensive data model validation...');
            
            // Wait for app to initialize
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Access the SignalsStore
            const store = window.SignalsStore;
            if (!store) {
                document.getElementById('dataLoadTest').innerHTML = '<span class="status fail">FAIL: SignalsStore not found</span>';
                return;
            }
            
            const signals = store.getSignals();
            const actionPlans = store.getActionPlans();
            
            // Test 1: Data Loading
            const dataLoadDiv = document.getElementById('dataLoadTest');
            if (signals && signals.length > 0) {
                dataLoadDiv.innerHTML = `
                    <span class="status pass">‚úÖ PASS</span>
                    <div class="test-result">
                        <strong>Signals Loaded:</strong> ${signals.length}<br>
                        <strong>Action Plans Loaded:</strong> ${actionPlans ? actionPlans.length : 0}<br>
                        <strong>First Signal ID:</strong> ${signals[0].id}
                    </div>
                `;
            } else {
                dataLoadDiv.innerHTML = '<span class="status fail">‚ùå FAIL: No signals loaded</span>';
            }
            
            // Test 2: Field Coverage
            const fieldCoverageDiv = document.getElementById('fieldCoverageTest');
            const sampleSignal = signals[0];
            const allFields = [];
            const populatedFields = [];
            
            function checkFields(obj, prefix = '') {
                for (const [key, value] of Object.entries(obj)) {
                    const fieldPath = prefix ? `${prefix}.${key}` : key;
                    
                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        checkFields(value, fieldPath);
                    } else {
                        allFields.push(fieldPath);
                        if (value !== null && value !== '' && value !== 0) {
                            populatedFields.push(fieldPath);
                        }
                    }
                }
            }
            
            checkFields(sampleSignal);
            
            fieldCoverageDiv.innerHTML = `
                <span class="status ${allFields.length >= 100 ? 'pass' : 'fail'}">
                    ${allFields.length >= 100 ? '‚úÖ' : '‚ùå'} ${allFields.length} fields found
                </span>
                <div class="test-result">
                    <strong>Total Fields:</strong> ${allFields.length}<br>
                    <strong>Populated Fields:</strong> ${populatedFields.length}<br>
                    <strong>Coverage:</strong> ${Math.round(populatedFields.length / allFields.length * 100)}%
                </div>
                <div class="field-list">
                    ${allFields.slice(0, 30).map(field => 
                        `<div class="field-item ${populatedFields.includes(field) ? 'has-value' : 'empty'}">
                            ${field}
                        </div>`
                    ).join('')}
                    ${allFields.length > 30 ? '<div class="field-item">... and ' + (allFields.length - 30) + ' more fields</div>' : ''}
                </div>
            `;
            
            // Test 3: Signal Polarity
            const polarityDiv = document.getElementById('polarityTest');
            const polarityValues = new Map();
            signals.forEach(signal => {
                const polarity = signal.signal_polarity || 'undefined';
                polarityValues.set(polarity, (polarityValues.get(polarity) || 0) + 1);
            });
            
            polarityDiv.innerHTML = `
                <span class="status ${polarityValues.size > 0 ? 'pass' : 'fail'}">
                    ${polarityValues.size > 0 ? '‚úÖ PASS' : '‚ùå FAIL'}
                </span>
                <div class="test-result">
                    <strong>Polarity Distribution:</strong><br>
                    ${Array.from(polarityValues.entries()).map(([polarity, count]) =>
                        `${polarity}: ${count} signals`
                    ).join('<br>')}
                </div>
            `;
            
            // Test 4: Plays System
            const playsDiv = document.getElementById('playsTest');
            const signalsWithPlays = signals.filter(s => s.plays && s.plays.length > 0);
            
            playsDiv.innerHTML = `
                <span class="status ${signalsWithPlays.length > 0 ? 'pass' : 'pending'}">
                    ${signalsWithPlays.length > 0 ? '‚úÖ PASS' : '‚ö†Ô∏è PENDING'}
                </span>
                <div class="test-result">
                    <strong>Signals with Plays:</strong> ${signalsWithPlays.length}<br>
                    ${signalsWithPlays.length > 0 ? `
                        <strong>First Play Example:</strong><br>
                        Name: ${signalsWithPlays[0].plays[0]?.name || 'N/A'}<br>
                        Type: ${signalsWithPlays[0].plays[0]?.play_type || 'N/A'}
                    ` : 'No plays found in signals'}
                </div>
            `;
            
            // Test 5: Account Metrics
            const metricsDiv = document.getElementById('metricsTest');
            const signalWithMetrics = signals.find(s => s.account_metrics && s.account_metrics.health_score);
            
            metricsDiv.innerHTML = `
                <span class="status ${signalWithMetrics ? 'pass' : 'fail'}">
                    ${signalWithMetrics ? '‚úÖ PASS' : '‚ùå FAIL'}
                </span>
                <div class="test-result">
                    ${signalWithMetrics ? `
                        <strong>Sample Account Metrics:</strong><br>
                        Health Score: ${signalWithMetrics.account_metrics.health_score}<br>
                        Account GPA: ${signalWithMetrics.account_metrics.account_gpa}<br>
                        At Risk Category: ${signalWithMetrics.account_metrics.at_risk_cat}<br>
                        Industry: ${signalWithMetrics.account_metrics.industry}
                    ` : 'No account metrics found'}
                </div>
            `;
            
            // Test 8: Performance
            const perfDiv = document.getElementById('performanceTest');
            const loadTime = performance.getEntriesByType('navigation')[0].loadEventEnd - 
                           performance.getEntriesByType('navigation')[0].fetchStart;
            
            perfDiv.innerHTML = `
                <span class="status ${loadTime < 3000 ? 'pass' : 'pending'}">
                    ${loadTime < 3000 ? '‚úÖ PASS' : '‚ö†Ô∏è SLOW'}
                </span>
                <div class="test-result">
                    <strong>Page Load Time:</strong> ${Math.round(loadTime)}ms<br>
                    <strong>Data Size:</strong> ${signals.length} signals<br>
                    <strong>Performance:</strong> ${loadTime < 1000 ? 'Excellent' : loadTime < 3000 ? 'Good' : 'Needs Optimization'}
                </div>
            `;
        }
        
        // Test CRUD operations
        function testCRUD() {
            const crudDiv = document.getElementById('crudTest');
            const store = window.SignalsStore;
            
            try {
                // Test creating an action plan
                const testPlan = {
                    id: 'test-' + Date.now(),
                    accountId: signals[0].account_id,
                    accountName: signals[0].account_name,
                    actionTitle: 'Test Action Plan',
                    status: 'pending'
                };
                
                store.createActionPlan(testPlan);
                const plans = store.getActionPlans();
                const created = plans.find(p => p.id === testPlan.id);
                
                crudDiv.innerHTML = `
                    <span class="status ${created ? 'pass' : 'fail'}">
                        ${created ? '‚úÖ CRUD Operations Working' : '‚ùå CRUD Failed'}
                    </span>
                    <div class="test-result">
                        Create: ${created ? 'PASS' : 'FAIL'}<br>
                        Read: PASS<br>
                        Update: ${created ? 'Testing...' : 'N/A'}<br>
                        Delete: ${created ? 'Testing...' : 'N/A'}
                    </div>
                `;
            } catch (error) {
                crudDiv.innerHTML = `<span class="status fail">‚ùå Error: ${error.message}</span>`;
            }
        }
        
        // Test view rendering
        function testViews() {
            const viewDiv = document.getElementById('viewTest');
            const views = ['signals', 'portfolio', 'action-plans'];
            let results = [];
            
            views.forEach(view => {
                try {
                    // Simulate view switch
                    window.location.hash = '#' + view;
                    const element = document.querySelector('.view-content');
                    results.push(`${view}: ${element ? 'PASS' : 'FAIL'}`);
                } catch (error) {
                    results.push(`${view}: ERROR`);
                }
            });
            
            viewDiv.innerHTML = `
                <span class="status pass">‚úÖ Views Tested</span>
                <div class="test-result">
                    ${results.join('<br>')}
                </div>
            `;
        }
        
        // Run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runTests, 1500);
        });
    </script>
</body>
</html>